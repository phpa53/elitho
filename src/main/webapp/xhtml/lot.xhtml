<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:component xmlns="http://www.w3.org/1999/xhtml"
	xmlns:c="jakarta.tags.core"
	xmlns:cc="jakarta.faces.composite"
	xmlns:f="jakarta.faces.core"
	xmlns:faces="jakarta.faces"
	xmlns:fn="jakarta.tags.functions"
	xmlns:h="jakarta.faces.html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pass="jakarta.faces.passthrough"
	xmlns:ui="jakarta.faces.facelets">
	
	<h:form id="lotForm" prependId="false">
	
		<p:ajaxStatus styleClass="block mb-4">
	        <f:facet name="start">
	            <i class="pi pi-spin pi-spinner loading-icon"></i>
	        </f:facet>
	    </p:ajaxStatus>
		<p:ajaxStatus onstart="PF('statusDialog').show()" onsuccess="PF('statusDialog').hide()"/>

		<p:dialog widgetVar="statusDialog" modal="true" draggable="false" closable="false" resizable="false"
			showHeader="false">
			<div class="text-center">
            	<i class="pi pi-spin pi-spinner loading-icon"></i>
			</div>
		</p:dialog>
		
		<p:growl id="lotGrowl" showDetail="true" life="3000"/>
		
		<p:dataTable id="lotDT"
        	widgetVar="lotDTW"
        	var="lot"
        	value="#{lotBean.getLots()}"
        	rowKey="#{lot.getRowKey()}"
			scrollable="true"
			scrollHeight="1800"
			lazy="false"
			sortMode="multiple"
			virtualScroll="false"
			tableStyle="width:overflow"
			styleClass="custom-footer-paginator"
        	style="margin-top:-20px;"
			resizableColumns="true"
			resizeMode="expand"
			size="small"
			rows="100"
			paginator="true"
			paginatorAlwaysVisible="true"
			paginatorPosition="bottom"
               paginatorTemplate="{CurrentPageReport} {RowsPerPageDropdown} {FirstPageLink} {PreviousPageLink}
               	{PageLinks} {NextPageLink} {LastPageLink}"
               rowsPerPageTemplate="100,500,1000,2000,3000,4000,5000,10000,{ShowAll|'All'}"
			currentPageReportTemplate="Found {totalRecords} lots"
            editable="false"
			editInitEvent="click"
			editMode="cell"
            selectionMode="single"
            selection="#{lotBean.selectedLot}"
            selectionPageOnly="false"
            disabledSelection="false"
			draggableColumns="true"
			stripedRows="true"
			disabledTextSelection="false"
			cache="true"
        	showGridlines="true">
        	
        	<p:ajax event="rowDblselect"
				listener="#{lotBean.onLotRowDblClick}"
				update="lotdetailsurl"
				oncomplete="var url=$('#elithoTabView\\:lotDT\\:lotdetailsurl').val();
					if (url) {window.open(url, '_blank');}"/>
        	
        	<f:facet name="header">
        		<h:inputText id="lotdetailsurl" value="#{lotBean.lotDetailsUrl}" style="display:none;"/>
	        	<div style="display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;
	                	margin-top:3px;margin_bottom:3px;">
                    <span style="margin-top:-5px;">
                    	<p:commandButton icon="pi pi-file-excel" styleClass="ml-2" title="export">
		                    <p:dataExporter type="xlsx"
			                    target="lotDT"
			                    fileName="elitho-lot-#{lotBean.getExcelExtension()}"
			                    postProcessor="#{lotBean.postProcessXLS}"
			                    exportFooter="false"/>
		                </p:commandButton>
		                <p:commandButton icon="pi pi-times-circle"
		                	title="Clear Filter"
		                	styleClass="ml-1"
		                	actionListener="#{lotBean.initFilter()}"
		                	update="lotFromDateDP lotToDateDP lotClusterSCM lotTechnoSCM lotMasksetSCM lotLayerSCM
		                		lotLotIdSCM lotStartSCM"/>
				    	<p:outputLabel for="@next" value="From:" styleClass="ml-2"/>
		                <p:datePicker id="lotFromDateDP"
		                	widgetVar="lotFromDateDP"
		                	styleClass="ml-1"
		                	value="#{lotBean.lotDates.fromDate}"
		                	size="6"
		                	mindate="#{lotBean.lotDates.fromDateMin}"
		                	maxdate="#{lotBean.lotDates.fromDateMax}"
		                	pattern="dd MMM yy"
		                	showWeek="true">
		                	<p:ajax listener="#{lotBean.lotDates.updateToDate()}"
		                		process="@this"
		                		update="lotToDateDP"
		                		oncomplete="PF('lotFromDateDP').hide();"/>
		                </p:datePicker>
				    	<p:outputLabel for="@next" value="To:" styleClass="ml-2"/>
		                <p:datePicker id="lotToDateDP"
		                	widgetVar="lotToDateDP"
		                	styleClass="ml-1"
		                	value="#{lotBean.lotDates.toDate}"
		                	size="6"
		                	mindate="#{lotBean.lotDates.toDateMin}"
		                	maxdate="#{lotBean.lotDates.toDateMax}"
		                	pattern="dd MMM yy"
		                	showWeek="true">
		                	<p:ajax listener="#{lotBean.lotDates.updateFromDate()}"
		                		process="@this"
		                		update="lotFromDateDP"
		                		oncomplete="PF('lotToDateDP').hide();"/>
		                </p:datePicker>
		                <p:selectCheckboxMenu id="lotClusterSCM"
		                	label="Cluster"
			             	style="margin-left:5px;"
			             	scrollHeight="500"
			             	value="#{lotBean.lotFilter.clusters}">
			                <f:selectItems value="#{lotBean.clusters}"/>
			                <p:ajax listener="#{lotBean.initTechnos}"
			                	process="@this"
			                	update="lotTechnoSCM lotMasksetSCM lotLayerSCM lotLotIdSCM"/>
			                <p:ajax event="toggleSelect"
			                 	listener="#{lotBean.initTechnos}"
			                 	process="@this"
			                 	update="lotTechnoSCM lotMasksetSCM lotLayerSCM lotLotIdSCM"/>
			            </p:selectCheckboxMenu>
		                <p:selectCheckboxMenu id="lotTechnoSCM"
		                	label="Techno"
			             	styleClass="ml-1"
			             	scrollHeight="500"
			             	value="#{lotBean.lotFilter.technos}">
			                <f:selectItems value="#{lotBean.technos}"/>
			                <p:ajax listener="#{lotBean.initMasksets}"
			                	process="@this"
			                	update="lotMasksetSCM lotLayerSCM lotLotIdSCM"/>
			                <p:ajax event="toggleSelect"
			                 	listener="#{lotBean.initMasksets}"
			                 	process="@this"
			                 	update="lotMasksetSCM lotLayerSCM lotLotIdSCM"/>
			            </p:selectCheckboxMenu>
		                <p:selectCheckboxMenu id="lotMasksetSCM"
		                	label="Maskset"
			             	styleClass="ml-1"
			             	scrollHeight="500"
			             	value="#{lotBean.lotFilter.masksets}">
			                <f:selectItems value="#{lotBean.masksets}"/>
			                <p:ajax listener="#{lotBean.initLayers}"
			                	process="@this"
			                	update="lotLayerSCM lotLotIdSCM"/>
			                <p:ajax event="toggleSelect"
			                 	listener="#{lotBean.initLayers}"
			                 	process="@this"
			                 	update="lotLayerSCM lotLotIdSCM"/>
			            </p:selectCheckboxMenu>
		                <p:selectCheckboxMenu id="lotLayerSCM"
		                	label="Layer"
			             	styleClass="ml-1"
			             	scrollHeight="500"
			             	value="#{lotBean.lotFilter.layers}">
			                <f:selectItems value="#{lotBean.layers}"/>
			                <p:ajax listener="#{lotBean.initLotIds}"
			                	process="@this"
			                	update="lotLotIdSCM"/>
			                <p:ajax event="toggleSelect"
			                 	listener="#{lotBean.initLotIds}"
			                 	process="@this"
			                 	update="lotLotIdSCM"/>
			            </p:selectCheckboxMenu>
		                <p:selectCheckboxMenu id="lotLotIdSCM"
		                	label="Lot ID"
			             	styleClass="ml-1"
			             	scrollHeight="500"
			             	value="#{lotBean.lotFilter.lotIds}">
			                <f:selectItems value="#{lotBean.lotIds}"/>
			                <p:ajax listener="#{lotBean.initLotStarts}"
			                	process="@this"
			                	update="lotStartSCM"/>
			                <p:ajax event="toggleSelect"
			                 	listener="#{lotBean.initLotStarts}"
			                 	process="@this"
			                 	update="lotStartSCM"/>
			            </p:selectCheckboxMenu>
		                <p:selectCheckboxMenu id="lotStartSCM"
		                	label="Lot Starts"
			             	styleClass="ml-1"
			             	scrollHeight="500"
			             	value="#{lotBean.lotStarts}">
			                <f:selectItems value="#{lotBean.getFormattedLotStarts()}"/>
			            </p:selectCheckboxMenu>
						<p:commandButton id="lotApplyCB"
			               	value="Apply"
			                styleClass="ml-1"
			               	actionListener="#{lotBean.apply}"
			                update="lotDT"
							oncomplete="resizeLotTable();return false;"/>
					</span>
				</div>
			</f:facet>
			<p:column headerText="Start" style="width:110px;text-align:center;" sortBy="#{lot.start}">
                <h:outputText value="#{lot.getFormattedStart()}"/>
			</p:column>
			<p:column headerText="Cluster"
        		style="width:100px;text-align:center;"
				sortBy="#{lot.cluster}"
            	filterBy="#{lot.cluster}"
            	filterFunction="#{lotBean.stringFilter}"
          		filterMatchMode="contains">
          		<f:facet name="filter">
            		<p:inputText style="width:90px;"
            			onkeydown="if (event.key === 'Enter') { PF('lotDTW').filter(); return false; }"/>
                </f:facet>
                <h:outputText value="#{lot.cluster}"/>
			</p:column>
			<p:column headerText="Techno"
        		style="width:80px;text-align:center;"
				sortBy="#{lot.techno}"
            	filterBy="#{lot.techno}"
            	filterFunction="#{lotBean.stringFilter}"
          		filterMatchMode="contains">
          		<f:facet name="filter">
            		<p:inputText style="width:80px;"
            			onkeydown="if (event.key === 'Enter') { PF('lotDTW').filter(); return false; }"/>
                </f:facet>
                <h:outputText value="#{lot.techno}"/>
			</p:column>
			<p:column headerText="Maskset"
        		style="width:130px;text-align:center;"
				sortBy="#{lot.maskset}"
            	filterBy="#{lot.maskset}"
            	filterFunction="#{lotBean.stringFilter}"
          		filterMatchMode="contains">
          		<f:facet name="filter">
            		<p:inputText style="width:120px;"
            			onkeydown="if (event.key === 'Enter') { PF('lotDTW').filter(); return false; }"/>
                </f:facet>
                <h:outputText value="#{lot.maskset}"/>
			</p:column>
			<p:column headerText="Layer"
        		style="width:120px;text-align:center;"
				sortBy="#{lot.layer}"
            	filterBy="#{lot.layer}"
            	filterFunction="#{lotBean.stringFilter}"
          		filterMatchMode="contains">
          		<f:facet name="filter">
            		<p:inputText style="width:110px;"
            			onkeydown="if (event.key === 'Enter') { PF('lotDTW').filter(); return false; }"/>
                </f:facet>
                <h:outputText value="#{lot.layer}"/>
			</p:column>
			<p:column headerText="Lot ID"
        		style="width:200px;text-align:center;"
				sortBy="#{lot.lotId}"
            	filterBy="#{lot.lotId}"
            	filterFunction="#{lotBean.stringFilter}"
          		filterMatchMode="contains">
          		<f:facet name="filter">
            		<p:inputText style="width:190px;"
            			onkeydown="if (event.key === 'Enter') { PF('lotDTW').filter(); return false; }"/>
                </f:facet>
                <h:outputText value="#{lot.lotId}"/>
			</p:column>
			<p:column/>
        	
        </p:dataTable>
		
    </h:form>
	
</ui:component>